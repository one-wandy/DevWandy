{% extends "base/base.html" %}
{% block content %}
{% load static %}
{% load humanize %}





      <style>


      .btn-calculadora {
            background-color: var(--bg-enfasis) !important;
            color: white !important;
            width: max-content !important;
      }

      .btn-calculadora img {
            display: none;
      }

      .input-selec .input-s{
            border: 0px solid var(--bg-enfasis);
            width: 100%; padding: 0.6rem; margin: 0.5rem;

            background-color: white;  border-radius: 2rem;
      }
      #interes, #cuotas
      {
            background-color: rgb(238, 238, 238); padding: 0.2rem; 
            border-radius: 50%; 
            text-align: center; border: 0px;
      }
      #tipoTasa, #tipoAmortizacion

      {
            background-color: rgb(238, 238, 238); padding: 0.2rem; 
            text-align: center;
            border-radius: 0.8rem;
      }
      </style>

<h2 class="mb-4 p-1">Calculadora de interes extensa</h2>

<section data-aos="fade-in" style="transition: 1s;" class="d-flex w-100 justify-content-around input-selec"> 
      <div class="input-s">
            <label for="tipoAmortizacion">Tipo de Amortización</label>
            <select class="border-0" id="tipoAmortizacion">
                <option value="frances">Francés</option>
                <option value="americano">Americano</option>
                <option value="interesesFijos">Intereses Fijos</option>
            </select>
      </div>

     

      <div class="input-s">
            <label for="tipoTasa">Periodo de interes</label>
            <select class="border-0 ps-3 pe-3" id="tipoTasa">
                  <option value="mensual">Mensual</option>
                  <option value="anual">Anual</option>
                  <option value="semanal">Semanal</option>
            </select>


            
      </div>
      <div class="input-s">
            <label for="interes">Interés %</label>
            <select class="border-0 " id="interes">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="10">10</option>
                  <option value="15" selected>15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="25">25</option>
                  <option value="26">26</option>
                  <option value="27">27</option>
                  <option value="28">28</option>
                  <option value="29">29</option>
                  <option value="30">30</option>
                  <option value="31">31</option>
                  <option value="32">32</option>
                  <option value="33">33</option>
                  <option value="34">34</option>
                  <option value="35">35</option>
            </select>      
      </div>
</section>

<section class="d-flex ms-2">
      <label for="capital"></label>
<input type="text"  class="border-0 rounded-5 p-2" id="capital" placeholder="Ingrese el capital"><br><br>


<div class="input-selec pt-2 ms-3">
      <label for="cuotas">Cantidad de cuotas #</label>
      <select class="bg-white" id="cuotas">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4" selected>4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
            <option value="31">31</option>
            <option value="32">32</option>
            <option value="33">33</option>
            <option value="34">34</option>
            <option value="35">35</option>
            <option value="36">36</option>
            <option value="37">37</option>
            <option value="38">38</option>
      </select>
</div>

</section>

<!-- <button onclick="calcular()">Calcular</button> -->
<p id="resultado" class="mt-2 ms-2">La cuota es $DOP 0.00</p>

<script>


document.querySelectorAll('input, select').forEach(element => {
      element.addEventListener('input', calcular);
});

      document.getElementById('capital').addEventListener('input', function (e) {
            let value = e.target.value;
            value = value.replace(/,/g, ''); // Remove existing commas
            value = parseFloat(value);
            if (isNaN(value)) {
                  e.target.value = '';
            } else {
                  e.target.value = value.toLocaleString('en-US'); // Add commas
            }
      });
      
    // Función principal
    function calcular() {



      let capital = document.getElementById('capital').value;
      capital = parseFloat(capital.replace(/,/g, ''));

        const interes = parseFloat(document.getElementById('interes').value) / 100;
        const tipoTasa = document.getElementById('tipoTasa').value;
        const cuotas = parseInt(document.getElementById('cuotas').value);
        const tipoAmortizacion = document.getElementById('tipoAmortizacion').value;

        // Ajustar tasa de interés
        let interesAjustado;
        if (tipoTasa === "anual") {
            interesAjustado = interes / 12; // Convierte anual a mensual
        } else if (tipoTasa === "mensual") {
            interesAjustado = interes; // Mantiene mensual
        } else if (tipoTasa === "semanal") {
            interesAjustado = interes / 4.33; // Convierte semanal a mensual (aproximación)
        } else {
            document.getElementById('resultado').innerText = "Tipo de tasa no válido.";
            return;
        }

        // Calcular según el tipo de amortización
        let resultado;
        if (tipoAmortizacion === "frances") {
            resultado = calcularFrances(capital, interesAjustado, cuotas);
        } else if (tipoAmortizacion === "americano") {
            resultado = calcularAmericano(capital, interesAjustado, cuotas);
        } else if (tipoAmortizacion === "interesesFijos") {
            resultado = calcularInteresesFijos(capital, interesAjustado, cuotas);
        } else {

            document.getElementById('resultado').innerText = "Tipo de amortización no válido.";

            return;
        }
      if (isNaN(resultado) || resultado === null) {
          resultado = 0;
      }
      resultado = resultado.toLocaleString('us', { 
            style: 'currency', currency: 'DOP', 
            minimumFractionDigits: 2, maximumFractionDigits: 2 
      });



      document.getElementById('resultado').innerText = `La cuota es $${resultado}`;
    }

    // Amortización Francés
    function calcularFrances(capital, interes, cuotas) {
        return capital * interes / (1 - Math.pow(1 + interes, -cuotas));
    }

// Amortización Americano
function calcularAmericano(capital, interes, cuotas) {
    // El pago de interés es constante
    const pagoInteres = capital * interes;
    // El capital completo se devuelve en la última cuota
    return pagoInteres; // Solo muestra el pago de interés periódico
}

// Amortización Intereses Fijos
function calcularInteresesFijos(capital, interes, cuotas) {
    const pagoInteres = capital * interes; // Interés fijo en cada cuota
    const pagoCapital = capital / cuotas; // Porción del capital en cada cuota
    const cuota = pagoInteres + pagoCapital; // Total por cuota
    return cuota;
}
</script>









{% endblock %}